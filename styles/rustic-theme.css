/* ============================================
   ÁRBOL GENEALÓGICO - TEMA RÚSTICO/CLÁSICO
   Estilo pergamino antiguo con árbol de fondo
   ============================================ */

/* ============ IMPORTAR FUENTES GOOGLE ============ */
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap');

/* ============ VARIABLES DEL TEMA RÚSTICO ============ */
.visual-theme-rustic {
  /* Colores base pergamino */
  --rustic-parchment: #f4e4bc;
  --rustic-parchment-light: #fdf8ed;
  --rustic-parchment-dark: #e8d4a8;
  
  /* Colores madera */
  --rustic-wood-dark: #3e2723;
  --rustic-wood-medium: #5c4033;
  --rustic-wood-light: #8b6914;
  --rustic-branch: #4a3728;
  
  /* Colores tinta */
  --rustic-ink: #2c1810;
  --rustic-ink-faded: #6d4c41;
  --rustic-ink-light: #8d6e63;
  
  /* Colores decorativos */
  --rustic-gold: #c9a227;
  --rustic-gold-light: #d4af37;
  --rustic-sepia: #704214;
  --rustic-leaf-green: #2e7d32;
  --rustic-leaf-dark: #1b5e20;
  
  /* Sombras especiales */
  --rustic-shadow: rgba(62, 39, 35, 0.4);
  --rustic-shadow-soft: rgba(92, 64, 51, 0.2);
  --rustic-glow: rgba(201, 162, 39, 0.3);
}

/* ============ FONDO PRINCIPAL DEL ÁRBOL ============ */
.visual-theme-rustic .react-flow {
  background-color: var(--rustic-parchment) !important;
  background-image: none !important;
  position: relative;
}

.visual-theme-rustic .react-flow__pane {
  background-color: transparent !important;
  background-image: none !important;
}

.visual-theme-rustic .react-flow__background {
  display: none !important;
}

/* ============ CAPA DE FONDO CON ÁRBOL DIFUMINADO ============ */
.visual-theme-rustic .react-flow::before {
  content: '';
  position: absolute;
  inset: 0;
  /* Imagen del árbol difuminada */
  background-image: url('/background1.png');
  background-repeat: no-repeat;
  background-position: center center;
  background-size: cover;
  /* Difuminado suave */
  filter: blur(1.5px);
  opacity: 0.55;
  pointer-events: none;
  z-index: 0;
}

/* ============ OVERLAY PERGAMINO ENCIMA DEL ÁRBOL ============ */
.visual-theme-rustic .react-flow::after {
  content: '';
  position: absolute;
  inset: 0;
  /* Gradiente de pergamino más sutil */
  background: radial-gradient(
    ellipse at center,
    rgba(244, 228, 188, 0.25) 0%,
    rgba(244, 228, 188, 0.35) 40%,
    rgba(232, 212, 168, 0.45) 100%
  );
  pointer-events: none;
  z-index: 1;
}

/* ============ TARJETAS DE PERSONA - ESTILO MARCO ANTIGUO ============ */
.visual-theme-rustic .rustic-node {
  /* Fondo pergamino claro */
  background: linear-gradient(
    145deg,
    var(--rustic-parchment-light) 0%,
    var(--rustic-parchment) 50%,
    var(--rustic-parchment-dark) 100%
  ) !important;
  
  /* Marco estilo cuadro antiguo */
  border: 3px double var(--rustic-wood-medium) !important;
  border-radius: 4px !important;
  
  /* Sombras para efecto de relieve */
  box-shadow: 
    /* Sombra interna - manchas de viejo */
    inset 0 0 15px var(--rustic-shadow-soft),
    /* Borde interno decorativo */
    inset 0 0 0 1px rgba(139, 105, 20, 0.3),
    /* Sombra exterior - flotando */
    3px 4px 8px var(--rustic-shadow),
    /* Brillo sutil en la esquina superior */
    -1px -1px 0 rgba(255, 255, 255, 0.3) !important;
  
  /* Tipografía */
  font-family: 'Cinzel', serif !important;
  
  /* Asegurar que esté por encima del overlay */
  position: relative;
  z-index: 2;
  
  /* Transición suave */
  transition: all 0.3s ease !important;
}

/* Efecto hover en las tarjetas rústicas */
.visual-theme-rustic .rustic-node:hover {
  box-shadow: 
    inset 0 0 15px var(--rustic-shadow-soft),
    inset 0 0 0 1px rgba(139, 105, 20, 0.3),
    4px 6px 12px var(--rustic-shadow),
    -1px -1px 0 rgba(255, 255, 255, 0.3),
    0 0 20px var(--rustic-glow) !important;
  transform: translateY(-2px);
}

/* Tarjeta enfocada */
.visual-theme-rustic .rustic-node.focused {
  border-color: var(--rustic-gold) !important;
  box-shadow: 
    inset 0 0 15px var(--rustic-shadow-soft),
    inset 0 0 0 2px var(--rustic-gold-light),
    4px 6px 12px var(--rustic-shadow),
    0 0 25px var(--rustic-glow) !important;
}

/* ============ TIPOGRAFÍA DENTRO DE LAS TARJETAS ============ */
.visual-theme-rustic .rustic-node .node-name,
.visual-theme-rustic .rustic-couple-node .node-name {
  color: var(--rustic-ink) !important;
  font-family: 'Cinzel', serif !important;
  font-weight: 600 !important;
  letter-spacing: 0.3px !important;
  text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.5);
  line-height: 1.1 !important;
  white-space: nowrap !important;
}

.visual-theme-rustic .rustic-node .node-surnames,
.visual-theme-rustic .rustic-couple-node .node-surnames {
  color: var(--rustic-ink-faded) !important;
  font-family: 'Cormorant Garamond', serif !important;
  font-weight: 500 !important;
  letter-spacing: 0.2px !important;
  line-height: 1.1 !important;
  white-space: nowrap !important;
}

/* Línea divisoria estilo rústico */
.visual-theme-rustic .rustic-divider {
  background: linear-gradient(
    90deg,
    transparent 0%,
    var(--rustic-wood-medium) 20%,
    var(--rustic-wood-medium) 80%,
    transparent 100%
  );
  opacity: 0.5;
}

.visual-theme-rustic .rustic-node .node-role,
.visual-theme-rustic .rustic-couple-node .node-role {
  color: var(--rustic-sepia) !important;
  font-family: 'Cormorant Garamond', serif !important;
  font-weight: 600 !important;
  font-size: 10px !important;
  text-transform: uppercase !important;
  letter-spacing: 2px !important;
}

/* ============ AVATAR EN ESTILO RÚSTICO ============ */
.visual-theme-rustic .rustic-node .node-avatar {
  border: 2px solid var(--rustic-wood-medium) !important;
  box-shadow: 
    inset 0 0 5px var(--rustic-shadow-soft),
    2px 2px 4px var(--rustic-shadow) !important;
}

.visual-theme-rustic .rustic-node .node-avatar-placeholder {
  background: linear-gradient(
    135deg,
    var(--rustic-parchment-dark) 0%,
    var(--rustic-parchment) 100%
  ) !important;
  border: 2px solid var(--rustic-wood-medium) !important;
  color: var(--rustic-ink) !important;
  font-family: 'Cinzel', serif !important;
  font-weight: 700 !important;
}

/* ============ LÍNEAS DE CONEXIÓN - RAMAS DEL ÁRBOL (Custom BranchEdge) ============ */
/* Los estilos del edge personalizado están en el componente BranchEdge.tsx */
/* Estos estilos son fallback y para el edge-path por defecto */
.visual-theme-rustic .react-flow__edge-path {
  stroke: var(--rustic-branch) !important;
  stroke-width: 2.5px !important;
  stroke-linecap: round !important;
  stroke-linejoin: round !important;
}

/* Ocultar el edge-path por defecto cuando usamos custom edge */
.visual-theme-rustic .branch-edge-group + .react-flow__edge-path {
  display: none;
}

.visual-theme-rustic .react-flow__edge.selected .react-flow__edge-path {
  stroke: var(--rustic-gold) !important;
  stroke-width: 4px !important;
}

/* ============ HANDLE (PUNTOS DE CONEXIÓN) ============ */
.visual-theme-rustic .react-flow__handle {
  background: var(--rustic-branch) !important;
  border: 2px solid var(--rustic-wood-dark) !important;
  width: 10px !important;
  height: 10px !important;
}

/* ============ CONTROLES DE REACT FLOW ============ */
.visual-theme-rustic .react-flow__controls {
  background: linear-gradient(
    145deg,
    var(--rustic-parchment-light) 0%,
    var(--rustic-parchment) 100%
  ) !important;
  border: 2px solid var(--rustic-wood-medium) !important;
  border-radius: 8px !important;
  box-shadow: 3px 3px 8px var(--rustic-shadow) !important;
}

.visual-theme-rustic .react-flow__controls-button {
  background: transparent !important;
  color: var(--rustic-ink) !important;
  border-bottom: 1px solid var(--rustic-shadow-soft) !important;
}

.visual-theme-rustic .react-flow__controls-button:hover {
  background: var(--rustic-parchment-dark) !important;
}

.visual-theme-rustic .react-flow__controls-button:last-child {
  border-bottom: none !important;
}

/* ============ MINIMAP ============ */
.visual-theme-rustic .react-flow__minimap {
  background: var(--rustic-parchment) !important;
  border: 2px solid var(--rustic-wood-medium) !important;
  border-radius: 8px !important;
  box-shadow: 3px 3px 8px var(--rustic-shadow) !important;
}

/* ============ COUPLE NODE - TARJETA DE PAREJA ============ */
.visual-theme-rustic .rustic-couple-node {
  background: linear-gradient(
    145deg,
    var(--rustic-parchment-light) 0%,
    var(--rustic-parchment) 50%,
    var(--rustic-parchment-dark) 100%
  ) !important;
  border: 3px double var(--rustic-wood-medium) !important;
  border-radius: 4px !important;
  box-shadow: 
    inset 0 0 15px var(--rustic-shadow-soft),
    inset 0 0 0 1px rgba(139, 105, 20, 0.3),
    3px 4px 8px var(--rustic-shadow) !important;
  position: relative;
  z-index: 2;
}

/* Avatar dentro de couple node */
.visual-theme-rustic .rustic-couple-node .node-avatar {
  border: 2px solid var(--rustic-wood-medium) !important;
  box-shadow: 
    inset 0 0 5px var(--rustic-shadow-soft),
    2px 2px 4px var(--rustic-shadow) !important;
}

.visual-theme-rustic .rustic-couple-node .node-avatar-placeholder {
  border: 2px solid var(--rustic-wood-medium) !important;
  box-shadow: 
    inset 0 0 3px var(--rustic-shadow-soft),
    1px 1px 3px var(--rustic-shadow) !important;
}

/* Corazón de pareja en estilo rústico */
.visual-theme-rustic .couple-heart {
  color: var(--rustic-sepia) !important;
  text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
}

/* ============ ORNAMENTOS DECORATIVOS ============ */
.visual-theme-rustic .rustic-ornament {
  position: absolute;
  color: var(--rustic-gold);
  font-size: 16px;
  opacity: 0.6;
  pointer-events: none;
}

.visual-theme-rustic .rustic-ornament-tl {
  top: -8px;
  left: -8px;
}

.visual-theme-rustic .rustic-ornament-tr {
  top: -8px;
  right: -8px;
  transform: scaleX(-1);
}

.visual-theme-rustic .rustic-ornament-bl {
  bottom: -8px;
  left: -8px;
  transform: scaleY(-1);
}

.visual-theme-rustic .rustic-ornament-br {
  bottom: -8px;
  right: -8px;
  transform: scale(-1);
}

/* ============ SCROLLBAR RÚSTICO ============ */
.visual-theme-rustic ::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.visual-theme-rustic ::-webkit-scrollbar-track {
  background: var(--rustic-parchment);
  border-radius: 5px;
}

.visual-theme-rustic ::-webkit-scrollbar-thumb {
  background: var(--rustic-wood-medium);
  border-radius: 5px;
  border: 2px solid var(--rustic-parchment);
}

.visual-theme-rustic ::-webkit-scrollbar-thumb:hover {
  background: var(--rustic-wood-dark);
}

/* ============ ANIMACIÓN DE ENTRADA ============ */
@keyframes rustice-fade-in {
  from {
    opacity: 0;
    transform: translateY(10px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.visual-theme-rustic .rustic-node {
  animation: rustice-fade-in 0.4s ease-out;
}

/* ============ EFECTO PAPEL VIEJO EN BORDES ============ */
.visual-theme-rustic .rustic-node::before {
  content: '';
  position: absolute;
  inset: 2px;
  border: 1px solid var(--rustic-wood-light);
  border-radius: 2px;
  pointer-events: none;
  opacity: 0.5;
}

/* ============ BOTONES EN ESTILO RÚSTICO ============ */
.visual-theme-rustic button.rustic-button {
  background: linear-gradient(
    145deg,
    var(--rustic-parchment-light) 0%,
    var(--rustic-parchment) 100%
  ) !important;
  border: 2px solid var(--rustic-wood-medium) !important;
  color: var(--rustic-ink) !important;
  font-family: 'Cinzel', serif !important;
  box-shadow: 2px 2px 4px var(--rustic-shadow) !important;
  transition: all 0.2s ease !important;
}

.visual-theme-rustic button.rustic-button:hover {
  background: linear-gradient(
    145deg,
    var(--rustic-parchment) 0%,
    var(--rustic-parchment-dark) 100%
  ) !important;
  transform: translateY(-1px);
  box-shadow: 3px 3px 6px var(--rustic-shadow) !important;
}

/* ============ OVERLAY PARA EXPORTACIÓN ============ */
.visual-theme-rustic.exporting .react-flow::before {
  display: none;
}
